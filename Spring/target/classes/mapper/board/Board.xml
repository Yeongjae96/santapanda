<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.santapanda.board.mapper.BoardMapper">

	<select id="getBoard" resultType="kr.co.santapanda.board.vo.BoardVO">
		
		SELECT cb.board_no
			 , cb.title
			 , cb.password
			 , cb.content
			 , cb.create_user_id
			 , createUser.name as create_user_nm
			 , cb.create_dt
			 , cb.update_user_id
			 , updateUser.name as update_user_nm
			 , cb.update_dt
	      FROM com_board cb
	INNER JOIN com_user createUser
	        ON createUser.user_id = cb.create_user_id
	 LEFT JOIN com_user updateUser
	        ON updateUser.user_id = cb.update_user_id
	     WHERE board_no = #{boardNo}
	     
	</select>

	<select id="getBoardList" parameterType="kr.co.santapanda.board.vo.BoardVO" resultType="kr.co.santapanda.board.vo.BoardVO">
		
		SELECT cb.board_no
			 , cb.title
			 , cb.password
			 , cb.content
			 , cb.create_user_id
			 , createUser.name as create_user_nm
			 , cb.create_dt
			 , cb.update_user_id
			 , updateUser.name as update_user_nm
			 , cb.update_dt
	      FROM com_board cb
	INNER JOIN com_user createUser
	        ON createUser.user_id = cb.create_user_id
	 LEFT JOIN com_user updateUser
	        ON updateUser.user_id = cb.update_user_id
	      
	</select>
	
	<insert id="createBoard" parameterType="kr.co.santapanda.board.vo.BoardVO">
		
		<selectKey keyProperty="boardNo" resultType="String"  order="BEFORE">
			SELECT TO_CHAR(sysdate,'YYYY') || '-B' || LPAD(seq_board.nextval,5,0) FROM dual
		</selectKey>
		
		INSERT INTO com_board
				  ( board_no
				  , title
				  , password
				  , content
				  , create_user_id
				  , create_dt)
		   VALUES ( 
				    #{boardNo}
				  , #{title}
				  , #{password}
				  , #{content}
				  , #{createUserId}
				  , sysdate)
				  
	</insert>
	
	<update id="updateBoard" parameterType="kr.co.santapanda.board.vo.BoardVO">
		UPDATE com_board
		 SET ( title = #{title}
			   password = #{password}
			   content = #{content}
			   create_user_id = #{createUserId}
			   create_dt = #{createDt}
			   update_user_id = #{updateUserId}
			   update_dt = sysdate)
	    WHERE  board_no = #{boardNo}
	</update>

	<delete id="deleteBoard" parameterType="kr.co.santapanda.board.vo.BoardVO">
		DELETE FROM com_board
	     WHERE board_no = #{boardNo}
	</delete>


</mapper>